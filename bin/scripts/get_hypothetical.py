import pandas as pd

# list to store locus tags of hypothetical proteins
locus_tags = []

# read in .tsv file generated by Prodigal
tsv = snakemake.input[0]
df = pd.read_csv(tsv, sep='\t', usecols=['locus_tag', 'product'])

# number of rows in DataFrame
_n = df.shape[0]

# counter for while loop
n = 0

# loop through each row in the DataFrame
while n < _n:
    # extract locus tag and product from current row
    locus = str(df['locus_tag'][n])
    product = '>' + str(df['product'][n])

    # debug print messages
    print('Current locus tag:', locus)
    print('Current product:', product)

    # if product is 'hypothetical protein', add locus tag to list
    if product == '>hypothetical protein':
        locus_tags.append(locus)
        print('Added locus tag to list:', locus)

    # increment counter
    n = n + 1

# file to search for hypothetical proteins
fnn = snakemake.input[1]

# output file for extracted hypothetical proteins
hypothetical_proteins = snakemake.output[0]

# open input file
with open(fnn, 'r') as f:

    # read entire file into memory
    data = f.read()

    # loop through each locus tag
    for locus in locus_tags:

        # debug print messages
        print('Current locus tag:', locus)

        # find start and end indices of locus in input file
        start = data.find(locus)
        end = data.find('>', start + 1)

        # extract sequence between indices
        result = data[start:end]

        # debug print message
        print('Extracted sequence:', result)

        # open output file and write extracted sequence
        with open(hypothetical_proteins, 'a') as f:
            f.write('>' + result)
            print('Wrote extracted sequence to output file')


